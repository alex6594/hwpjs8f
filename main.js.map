{"version":3,"file":"main.js","mappings":"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","sources":["webpack://jsehw7f/./src/widgets/chat/js/user.js","webpack://jsehw7f/./src/widgets/chat/img/avatar.png","webpack://jsehw7f/./src/widgets/chat/js/message.js","webpack://jsehw7f/./src/widgets/chat/chat.js","webpack://jsehw7f/./src/js/app.js"],"sourcesContent":["import AVATAR from '../img/avatar.png';\n\nconst NAME_OWNER = 'Вы';\n\nexport default class User {\n  constructor(name, isOwner = false) {\n    this.userName = name;\n    this.isOwner = isOwner;\n  }\n\n  render() {\n    const liEl = document.createElement('li');\n    liEl.className = 'user_item';\n    if (this.isOwner) {\n      liEl.classList.add('active_user');\n    }\n\n    const divEl = document.createElement('div');\n    divEl.className = 'user';\n\n    const divImgEl = document.createElement('div');\n    divImgEl.className = 'user_image';\n    const avatarEl = document.createElement('img');\n    avatarEl.src = AVATAR;\n\n    const divIbEl = document.createElement('div');\n    divIbEl.className = 'user_name';\n    const userNameEl = document.createElement('h5');\n    userNameEl.className = 'user__name';\n    userNameEl.textContent = this.isOwner ? NAME_OWNER : this.userName;\n    avatarEl.alt = userNameEl.textContent;\n\n    divImgEl.appendChild(avatarEl);\n    divIbEl.appendChild(userNameEl);\n\n    divEl.appendChild(divImgEl);\n    divEl.appendChild(divIbEl);\n\n    liEl.appendChild(divEl);\n    return liEl;\n  }\n}\n","export default __webpack_public_path__ + \"assets/6c53c0a1c12e6d7eaa36e98c6696b38d.png\";","export default class Message {\n  constructor(userName, message, date, isOwner = false) {\n    this.userName = userName;\n    this.message = message;\n    this.isOwner = isOwner;\n    // console.log('class Message constructor:', userName, message, date);\n    this.date = date;\n    // console.log(this.date);\n  }\n\n  render() {\n    const messageEl = document.createElement('li');\n    messageEl.className = this.isOwner ? 'outgoing_msg' : 'incoming_msg';\n\n    const divMessage = document.createElement('div');\n    divMessage.className = 'msg';\n\n    const messageHeader = document.createElement('div');\n    messageHeader.className = 'msg_header';\n\n    const messageDateTime = document.createElement('span');\n    messageDateTime.className = 'msg_date_time';\n    messageDateTime.textContent = this.date;\n\n    const messageUser = document.createElement('span');\n    messageUser.className = 'msg_user';\n    messageUser.textContent = `${this.userName}, `;\n\n    messageHeader.appendChild(messageUser);\n    messageHeader.appendChild(messageDateTime);\n\n    const messageText = document.createElement('p');\n    messageText.className = 'msg_text';\n    messageText.textContent = this.message;\n\n    divMessage.appendChild(messageHeader);\n    divMessage.appendChild(messageText);\n    messageEl.appendChild(divMessage);\n    return messageEl;\n  }\n}\n","import './css/chat.css';\nimport User from './js/user';\nimport Message from './js/message';\n\n// Наименование стиля для скрытия объекта\nconst STYLE_HIDDEN = 'hidden';\n\n// Стиль bootstrap для невалидного объекта\nconst STYLE_IS_INVALID = 'is-invalid';\n\nexport default class ChatWidget {\n  constructor(parentEl, urlWebSocket) {\n    this.parentEl = parentEl;\n    this.urlWebSocket = urlWebSocket;\n    this.ws = null;\n  }\n\n  static get formChatHTML() {\n    return `\n      <div class=\"messaging\">\n        <div class=\"inbox_msg\">\n          <div class=\"left_side\">\n            <div class=\"heading_panel\">\n              <div class=\"recent_heading\">\n                <h4>Участники</h4>\n              </div>\n            </div>\n            <ul class=\"list-unstyled users_list\" data-id=\"users\"></ul>\n          </div>\n\n          <div class=\"right_side\">\n            <div class=\"heading_panel\">\n              <div class=\"recent_heading\">\n                <h4>Сообщения</h4>\n              </div>\n            </div>\n            <div class=\"messages\">\n              <ul class=\"msg_history list-unstyled\" data-id=\"messages\"></ul>\n              <div class=\"type_msg\">\n                <form data-id=\"form-message\">\n                  <input type=\"text\" data-id=\"message\" placeholder='Введите сообщение и нажмите \"Enter\"...' />\n                </form>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>    \n    `;\n  }\n\n  static get loadingHTML() {\n    return `\n      <div class=\"form-processing ${STYLE_HIDDEN}\">\n        <div class=\"overlay\" id=\"overlay\"></div>\n        <div class=\"loading-process\" id=\"loadingProcess\"></div>\n      </div>\n    `;\n  }\n\n  static get formErrorHTML() {\n    return `\n      <div class=\"dialog-error ${STYLE_HIDDEN}\">\n        <div class=\"overlay\" id=\"overlay\"></div>\n        <form class=\"form-ticket-delete row g-3\">\n          <div class=\"col-12\">\n            <div class=\"d-flex justify-content-center\">\n              <h5 class=\"form-title\">Ошибка</h5>\n            </div>\n            <p></p>\n          </div>\n          <div class=\"col-12 d-flex justify-content-end\">\n            <button type=\"submit\" value=\"submit\" class=\"submit-buttom btn btn-primary ms-2\">OK</button>\n          </div>\n        </form>\n      </div>\n      `;\n  }\n\n  static get formLoginHTML() {\n    return `\n      <div class=\"dialog-login\" data-id=\"dialog-login\">\n        <div class=\"overlay\" id=\"overlay\"></div>\n        <form class=\"form-login row g-3\" data-id=\"form-login\">\n          <div class=\"col-12 d-flex justify-content-center\">\n            <h5 class=\"form-title\">Выберите псевдоним</h5>\n          </div>\n          <div class=\"col-12\">\n            <input type=\"text\" class=\"form-control\" data-id = \"username\" required placeholder=\"Введите Ваше имя\">\n            <div class=\"invalid-feedback\">\n              Заданное имя уже занято. Выберите другое имя.\n            </div>\n          </div>\n          <div class=\"col-12 d-flex justify-content-center\">\n            <button type=\"submit\" value=\"submit\" class=\"submit-buttom btn btn-primary ms-2\">Продолжить</button>\n          </div>\n        </form>\n      </div>\n    `;\n  }\n\n  static idSelector(id) {\n    return `[data-id=\"${id}\"]`;\n  }\n\n  static get formLoginSelector() {\n    return '.form-login';\n  }\n\n  wsConnect() {\n    if (this.ws) {\n      this.ws.close(3001);\n    } else {\n      this.ws = new WebSocket(this.urlWebSocket);\n\n      this.wsOpen = this.wsOpen.bind(this);\n      this.ws.addEventListener('open', this.wsOpen);\n\n      this.wsClose = this.wsClose.bind(this);\n      this.ws.addEventListener('close', (evt) => this.wsClose(evt));\n\n      this.wsMessage = this.wsMessage.bind(this);\n      this.ws.addEventListener('message', (message) => this.wsMessage(message));\n\n      this.wsError = this.wsError.bind(this);\n      this.ws.addEventListener('error', (evt) => this.wsError(evt));\n    }\n  }\n\n  // Запуск виджета\n  run() {\n    // Отрисовка HTML\n    this.bindToDOM();\n\n    // Соединяемся с сокетом\n    this.wsConnect();\n\n    // Инициализация переменных и событий\n    this.init();\n  }\n\n  // Разметка HTML и отслеживание событий\n  bindToDOM() {\n    this.parentEl.innerHTML = '';\n    this.parentEl.innerHTML += ChatWidget.loadingHTML;\n    this.parentEl.innerHTML += ChatWidget.formErrorHTML;\n    this.parentEl.innerHTML += ChatWidget.formLoginHTML;\n    this.parentEl.innerHTML += ChatWidget.formChatHTML;\n  }\n\n  init() {\n    this.dialogLogin = this.parentEl.querySelector(ChatWidget.idSelector('dialog-login'));\n    this.ulUsers = this.parentEl.querySelector(ChatWidget.idSelector('users'));\n    this.ulMessages = this.parentEl.querySelector(ChatWidget.idSelector('messages'));\n    this.formMessage = this.parentEl.querySelector(ChatWidget.idSelector('form-message'));\n\n    // Строка ввода имени псевдонима\n    this.inputUserName = this.parentEl.querySelector(ChatWidget.idSelector('username'));\n    this.onChangeUserName = this.onChangeUserName.bind(this);\n    this.inputUserName.addEventListener('keydown', this.onChangeUserName);\n\n    // Обработка событий по подтверждению вводу псевдонима\n    const formLogin = this.dialogLogin.querySelector(ChatWidget.idSelector('form-login'));\n    this.onSubmitLogin = this.onSubmitLogin.bind(this);\n    formLogin.addEventListener('submit', (evt) => this.onSubmitLogin(evt));\n\n    // Обработка событий по отправке сообщения\n    this.onSendMessage = this.onSendMessage.bind(this);\n    this.formMessage.addEventListener('submit', (evt) => this.onSendMessage(evt));\n  }\n\n  wsOpen() {\n    console.log(`Соединение установлено. URL: ${this.urlWebSocket}`); // eslint-disable-line no-console\n  }\n\n  wsClose(evt) {\n    if (evt.wasClean) {\n      console.log('Соединение закрыто.'); // eslint-disable-line no-console\n\n      this.ws = null;\n    } else {\n      console.log('Обрыв соединения!'); // eslint-disable-line no-console\n    }\n    console.log(`Код: ${evt.code}; причина: ${evt.reason}`); // eslint-disable-line no-console\n  }\n\n  wsMessage(message) {\n    // console.log('Сообщение:', message);\n    const data = JSON.parse(message.data);\n    // console.log('Получены данные:', (data));\n\n    // Отрисовка всех текущих пользователей\n    if (data.renderUsers) {\n      this.users = data.names;\n      this.users.forEach((name) => {\n        this.ulUsers.appendChild(new User(name).render());\n      });\n    }\n\n    // Проверка: занято ли имя пользователя или нет\n    if (data.nameIsFree) {\n      this.dialogLogin.classList.add(STYLE_HIDDEN);\n      const user = new User(data.name, true).render();\n      this.ulUsers.appendChild(user);\n    } else if (data.nameIsFree === false) {\n      this.inputUserName.classList.add(STYLE_IS_INVALID);\n    }\n\n    // Добавился новый пользователь\n    if (data.renderName) {\n      this.ulUsers.appendChild(new User(data.name).render());\n      return;\n    }\n\n    // Выход пользователя из чата\n    if (data.closeUser) {\n      const usersArray = [...this.ulUsers.querySelectorAll('li')];\n      usersArray.forEach((user) => {\n        if (user.querySelector('.user__name').textContent === data.name) {\n          user.remove();\n        }\n      });\n    }\n\n    if (data.renderOwnMessage) {\n      this.ulMessages.appendChild(\n        new Message(data.name, data.message, data.date, true).render(),\n      );\n    }\n\n    if (data.renderMessage) {\n      this.ulMessages.appendChild(\n        new Message(data.name, data.message, data.date).render(),\n      );\n    }\n\n    if (data.renderMessages) {\n      // console.log('on data.renderMessages: ', data);\n      data.messages.forEach((msg) => {\n        this.ulMessages.appendChild(\n          new Message(msg.name, msg.message, msg.date).render(),\n        );\n      });\n    }\n  }\n\n  wsError(evt) {\n    console.log(`${this} Ошибка: ${evt.message}`); // eslint-disable-line no-console\n  }\n\n  onSubmitLogin(evt) {\n    evt.preventDefault();\n    // console.log(this.inputUserName)\n    const userName = this.inputUserName.value;\n    this.ws.send(JSON.stringify({ userName, chooseUserName: true }));\n    // evt.currentTarget.reset();\n  }\n\n  onSendMessage(evt) {\n    evt.preventDefault();\n    const messageText = this.formMessage.querySelector(ChatWidget.idSelector('message')).value;\n    // console.log('onSendMessage', messageText);\n    this.ws.send(\n      JSON.stringify({\n        chatMessage: true,\n        messageText,\n      }),\n    );\n    evt.currentTarget.reset();\n  }\n\n  onChangeUserName() {\n    if (this.inputUserName.classList.contains(STYLE_IS_INVALID)) {\n      this.inputUserName.classList.remove(STYLE_IS_INVALID);\n    }\n  }\n}\n","import ChatWidget from '../widgets/chat/chat';\n\n// Адрес вебсокета\n// const URL_WEBSOCKET = 'ws://localhost:7070';\nconst URL_WEBSOCKET = 'wss://sse-wss-chat.onrender.com//ws';\n\nconst chatWidget = new ChatWidget(document.querySelector('#widget-container'), URL_WEBSOCKET);\nchatWidget.run();\n"],"names":["User","constructor","name","isOwner","this","userName","render","liEl","document","createElement","className","classList","add","divEl","divImgEl","avatarEl","src","divIbEl","userNameEl","textContent","alt","appendChild","Message","message","date","messageEl","divMessage","messageHeader","messageDateTime","messageUser","messageText","STYLE_HIDDEN","STYLE_IS_INVALID","ChatWidget","parentEl","urlWebSocket","ws","formChatHTML","loadingHTML","formErrorHTML","formLoginHTML","static","id","formLoginSelector","wsConnect","close","WebSocket","wsOpen","bind","addEventListener","wsClose","evt","wsMessage","wsError","run","bindToDOM","init","innerHTML","dialogLogin","querySelector","idSelector","ulUsers","ulMessages","formMessage","inputUserName","onChangeUserName","formLogin","onSubmitLogin","onSendMessage","console","log","wasClean","code","reason","data","JSON","parse","renderUsers","users","names","forEach","nameIsFree","user","renderName","closeUser","querySelectorAll","remove","renderOwnMessage","renderMessage","renderMessages","messages","msg","preventDefault","value","send","stringify","chooseUserName","chatMessage","currentTarget","reset","contains"],"sourceRoot":""}